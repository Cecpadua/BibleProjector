<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>控制面板</title>
  <style>
    body { 
      margin: 0; 
      font-family: system-ui, sans-serif; 
      display: flex; 
      background: transparent;
    }
    .wrap { 
      width: 400px; 
      border-radius: 10px; 
      background: #ffffffcc; 
      backdrop-filter: blur(6px); 
      box-shadow: 0 8px 30px rgba(0,0,0,.2); 
      overflow: hidden; 
    }
    .settings-panel {
      width: 350px;
      background: #f8f9facc;
      backdrop-filter: blur(6px);
      border-radius: 10px;
      margin-left: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,.2);
      display: none;
      flex-direction: column;
    }
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: #e9ecef;
      border-radius: 10px 10px 0 0;
    }
    .settings-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-reset {
      background: #dc3545;
      color: white;
      font-size: 12px;
      padding: 4px 8px;
    }
    .btn-reset:hover {
      background: #c82333;
    }
    .settings-content {
      padding: 12px;
      flex: 1;
      overflow-y: auto;
    }
    .setting-group {
      margin-bottom: 16px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .setting-group h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      color: #495057;
    }
    .setting-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }
    .setting-item:last-child {
      margin-bottom: 0;
    }
    .setting-label {
      min-width: 80px;
      font-size: 12px;
      color: #666;
    }
    .setting-control {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .setting-value {
      min-width: 40px;
      font-size: 12px;
      color: #495057;
      text-align: right;
    }
    header { 
      display:flex; 
      align-items:center; 
      justify-content:space-between; 
      padding: 10px 12px; 
      background:#f3f3f3; 
      -webkit-app-region: drag; 
    }
    header .btn { 
      border:none; 
      background:#ddd; 
      padding:6px 10px; 
      border-radius:6px; 
      cursor:pointer; 
      -webkit-app-region: no-drag; 
    }
    header strong { -webkit-app-region: no-drag; }
    .row { padding: 8px 12px; }
    .input { width: 100%; padding: 8px 0px; border: 1px solid #ccc; border-radius:6px; font-size: 14px; }
    .input.error { border-color: #dc3545; background-color: #ffebee; }
    .buttons { display:flex; gap:8px; -webkit-app-region: no-drag; }
    .btn-primary { background:#1e90ff; color:#fff; }
    .btn-settings { background:#6c757d; color:#fff; }
    .btn-about { background:#17a2b8; color:#fff; }
    .preview-shell { padding: 8px 12px; }
    .preview-frame { width: 100%; background:#111; border-radius:8px; display: block; }
    .meta { color:#bbb; font-size: 12px; padding:4px 0; margin-bottom: 8px; }
    select { width: 100%; padding:6px; border-radius:6px; border:1px solid #ccc; }
    .suggestions { max-height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px; background: #fff; display: none; }
    .suggestion-item { padding: 6px 8px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 12px; }
    .suggestion-item:hover { background: #f0f0f0; }
    .suggestion-item:last-child { border-bottom: none; }
    .suggestion-item.info-only { cursor: default; background: #f8f9fa; }
    .suggestion-item.info-only:hover { background: #f8f9fa; }
    .suggestion-item.error-suggestion { cursor: default; background: #fff5f5; border-left: 3px solid #dc3545; }
    .suggestion-item.error-suggestion:hover { background: #fff5f5; }
    .suggestion-py { font-weight: bold; color: #1e90ff; }
    .suggestion-name { margin-left: 8px; }
    .suggestion-range { color: #666; margin-left: 4px; }
    
    /* 设置控件样式 */
    input[type="range"] {
      flex: 1;
      height: 4px;
      border-radius: 2px;
      background: #ddd;
      outline: none;
    }
    input[type="color"] {
      width: 30px;
      height: 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    /* 录制按钮样式 */
    .btn-record {
      background: #28a745;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      min-width: 40px;
    }
    .btn-record:hover {
      background: #218838;
    }
    .btn-record.recording {
      background: #dc3545;
      animation: pulse 1s infinite;
    }
    .btn-record.recording:hover {
      background: #c82333;
    }
    
    /* 录制动画 */
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    
    /* 快捷键输入框样式 */
    .setting-control input[type="text"] {
      flex: 1;
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      background: #f8f9fa;
    }
    
    .setting-control input[type="text"]:focus {
      outline: none;
      border-color: #007bff;
      background: white;
    }
    
    /* 搜索框禁用状态 */
    #quick:disabled {
      background: #e9ecef;
      color: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    /* 右键菜单样式 */
    .context-menu {
      position: fixed;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      padding: 4px 0;
      z-index: 1000;
      display: none;
      min-width: 120px;
    }
    
    .context-menu-item {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 12px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .context-menu-item:hover {
      background: #f0f0f0;
    }
    
    .context-menu-item:active {
      background: #e0e0e0;
    }
    
    .context-menu-item.disabled {
      color: #999;
      cursor: not-allowed;
    }
    
    .context-menu-item.disabled:hover {
      background: transparent;
    }
    
    .context-menu-icon {
      width: 12px;
      height: 12px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <strong>控制面板</strong>
      <div class="buttons">
        <button id="btnAbout" class="btn btn-about">关于</button>
        <button id="btnSettings" class="btn btn-settings">设置</button>
        <button id="btnToggle" class="btn btn-primary">开始投影 (F9)</button>
        <button id="btnExit" class="btn">退出</button>
      </div>
    </header>

    <div class="row">
      <label>快捷输入（如：CSJ 1 12 16）</label>
      <input id="quick" class="input" placeholder="输入并回车..."  inputmode="latin" pattern="[A-Za-z0-9]*" />
      <div id="suggestions" class="suggestions"></div>
    </div>

    <div class="row">
      <label>选择投影显示器</label>
      <select id="display"></select>
    </div>

    <div class="row">
      <label>历史记录</label>
      <select id="history"></select>
    </div>



    <div class="row" style="display: none;">
      <label>字体大小</label>
      <div style="display: flex; align-items: center; gap: 8px;">
        <input type="range" id="fontSize" min="2" max="13" step="1" value="8" style="flex: 1;" />
        <span id="fontSizeValue">8vh</span>
      </div>
    </div>

    <div class="preview-shell">
      <div class="meta" id="meta" style="display: none;"></div>
      <canvas id="preview" class="preview-frame" style="height: 245px;"></canvas>
    </div>
  </div>

  <!-- 关于面板 -->
  <div id="aboutPanel" class="settings-panel">
    <div class="settings-header">
      <strong>关于</strong>
      <div class="settings-actions">
        <button id="btnCloseAbout" class="btn">×</button>
      </div>
    </div>
    <div class="settings-content" style="height: 400px; padding: 20px; overflow-y: auto;">
      <!-- 教会标志 -->
      <div style="text-align: center; margin-bottom: 20px;">
        <img src="../assets/church-logo.png" alt="基督教帕多瓦华人教会" 
             style="max-width: 200px; max-height: 120px; width: auto; height: auto;" 
             onerror="this.style.display='none'">
       
      </div>
      
      <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="margin: 0 0 10px 0; color: #333;">CECP 圣经投影</h2>
        <p style="margin: 0; color: #666; font-size: 14px;">版本 1.0.0</p>
      </div>
      
      <div style="margin-bottom: 25px;">
        <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">功能特点</h3>
        <ul style="margin: 0; padding-left: 20px; color: #555; font-size: 13px; line-height: 1.6;">
          <li>多屏幕投影支持</li>
          <li>智能经文搜索</li>
          <li>实时预览与同步</li>
          <li>快捷键控制</li>
          <li>自定义显示设置</li>
          <li>右键复制功能</li>
          <li>输入验证提示</li>
        </ul>
      </div>
      
      <div style="margin-bottom: 25px;">
        <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">快捷键</h3>
        <div style="color: #555; font-size: 13px; line-height: 1.6;">
          <p style="margin: 5px 0;"><kbd style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">F9</kbd> - 切换投影</p>
          <p style="margin: 5px 0;"><kbd style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">↑/↓</kbd> - 上/下一节</p>
          <p style="margin: 5px 0;"><kbd style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">Esc</kbd> - 取消高亮/关闭投影</p>
          <p style="margin: 5px 0;"><kbd style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">Enter</kbd> - 执行搜索</p>
        </div>
      </div>
      
      <div style="margin-bottom: 25px;">
        <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">使用说明</h3>
        <div style="color: #555; font-size: 13px; line-height: 1.6;">
          <p style="margin: 5px 0;">• 输入格式：书卷拼音 章节 起始节 结束节</p>
          <p style="margin: 5px 0;">• 示例：CSJ 1 1（创世记第1章第1节）</p>
          <p style="margin: 5px 0;">• 示例：CSJ 1 1 3（创世记第1章1-3节）</p>
          <p style="margin: 5px 0;">• 右键点击预览区域可复制经文</p>
          <p style="margin: 5px 0;">• 使用历史记录快速重复搜索</p>
        </div>
      </div>
      
      <div style="margin-bottom: 25px;">
        <h3 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">技术信息</h3>
        <div style="color: #555; font-size: 13px; line-height: 1.6;">
          <p style="margin: 5px 0;">基于 Electron 框架开发</p>
          <p style="margin: 5px 0;">使用 Canvas 渲染技术</p>
          <p style="margin: 5px 0;">SQLite 数据库存储</p>
          <p style="margin: 5px 0;">支持 Windows、macOS、Linux</p>
        </div>
      </div>
      
      <div style="text-align: center; padding-top: 20px; border-top: 1px solid #eee;">
        <p style="margin: 0; color: #999; font-size: 12px;">© 2025 CECP. 保留所有权利。</p>
        <p style="margin: 5px 0 0 0; color: #999; font-size: 12px;">
          <a href="#" id="aboutGithub" style="color: #007bff; text-decoration: none;">GitHub 项目主页</a>
        </p>
      </div>
    </div>
  </div>

  <!-- 设置面板 -->
  <div id="settingsPanel" class="settings-panel">
    <div class="settings-header">
      <strong>设置</strong>
      <div class="settings-actions">
        <button id="btnResetSettings" class="btn btn-reset">重置</button>
        <button id="btnCloseSettings" class="btn">×</button>
      </div>
    </div>
    <div class="settings-content" style="height: 400px;">
      <!-- 显示设置 -->
      <div class="setting-group">
        <h4>显示设置</h4>
        <div class="setting-item">
          <span class="setting-label">字体大小</span>
          <div class="setting-control">
            <input type="range" id="settingFontSize" min="2" max="13" step="1" value="8" />
            <span id="settingFontSizeValue" class="setting-value">8vh</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">文字颜色</span>
          <div class="setting-control">
            <input type="color" id="settingTextColor" value="#ffffff" />
            <span id="settingTextColorValue" class="setting-value">#ffffff</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">背景颜色</span>
          <div class="setting-control">
            <input type="color" id="settingBackgroundColor" value="#000000" />
            <span id="settingBackgroundColorValue" class="setting-value">#000000</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">高亮背景</span>
          <div class="setting-control">
            <input type="color" id="settingHighlightBgColor" value="#1e90ff" />
            <span id="settingHighlightBgColorValue" class="setting-value">#1e90ff</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">高亮文字</span>
          <div class="setting-control">
            <input type="color" id="settingHighlightTextColor" value="#ffff00" />
            <span id="settingHighlightTextColorValue" class="setting-value">#ffff00</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">滚轮速度</span>
          <div class="setting-control">
            <input type="range" id="settingScrollSpeed" min="0.1" max="1.0" step="0.1" value="0.4" />
            <span id="settingScrollSpeedValue" class="setting-value">0.4</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">固定标题</span>
          <div class="setting-control">
            <input type="checkbox" id="settingFixedTitle" checked />
            <span id="settingFixedTitleValue" class="setting-value">开启</span>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">行高比例</span>
          <div class="setting-control">
            <input type="range" id="settingLineHeight" min="0.5" max="2.0" step="0.1" value="1.6" />
            <span id="settingLineHeightValue" class="setting-value">1.6</span>
          </div>
        </div>
      </div>

      <!-- 快捷键设置 -->
      <div class="setting-group">
        <h4>快捷键设置</h4>
        <div class="setting-item">
          <span class="setting-label">上一个经文</span>
          <div class="setting-control">
            <input type="text" id="settingPrevVerse" value="ArrowUp" readonly />
            <button class="btn-record" data-target="settingPrevVerse">录制</button>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">下一个经文</span>
          <div class="setting-control">
            <input type="text" id="settingNextVerse" value="ArrowDown" readonly />
            <button class="btn-record" data-target="settingNextVerse">录制</button>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">投屏</span>
          <div class="setting-control">
            <input type="text" id="settingProject" value="F9" readonly />
            <button class="btn-record" data-target="settingProject">录制</button>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">显示控制面板</span>
          <div class="setting-control">
            <input type="text" id="settingShowControl" value="Control+Space" readonly />
            <button class="btn-record" data-target="settingShowControl">录制</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 右键菜单 -->
  <div id="contextMenu" class="context-menu">
    <div class="context-menu-item" id="copyText">
      <span class="context-menu-icon">📋</span>
      复制高亮经文
    </div>
    <div class="context-menu-item" id="copyReference" style="display: none;">
      <span class="context-menu-icon">📖</span>
      复制引用
    </div>
    <div class="context-menu-item" id="copyAll">
      <span class="context-menu-icon">📄</span>
      复制全部
    </div>
  </div>

  <script type="module" src="./control.js"></script>
</body>
</html>
